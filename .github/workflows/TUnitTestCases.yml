name: TUnitTestProjectTestCases

on:
  push:
    branches: [master]
  workflow_dispatch:

jobs:
  build-and-test:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 8.0

      - name: Restore dependencies
        run: dotnet restore

      - name: Build solution
        run: dotnet build --no-restore --configuration Release

      # Run tests and capture output
      - name: Run tests
        run: dotnet test --filter "FullyQualifiedName~TUnitTestProject.Tests.StringHelperTests | FullyQualifiedName~TUnitTestProject.Tests.BooleanHelperTests | FullyQualifiedName~TUnitTestProject.Tests.MyCalculatorTests" `
              | tee test_output.txt
        shell: pwsh

      # Generate Custom Test Summary
      - name: Generate Test Summary
        if: always()
        run: |
          $output = Get-Content test_output.txt -Raw

          $passed  = ([regex]::Matches($output, "Passed: (\d+)")).Groups[1].Value
          $failed  = ([regex]::Matches($output, "Failed: (\d+)")).Groups[1].Value
          $skipped = ([regex]::Matches($output, "Skipped: (\d+)")).Groups[1].Value

          if (-not $passed)  { $passed = 0 }
          if (-not $failed)  { $failed = 0 }
          if (-not $skipped) { $skipped = 0 }

          $total = [int]$passed + [int]$failed + [int]$skipped

          Add-Content $env:GITHUB_STEP_SUMMARY "### üß™ Test Summary"
          Add-Content $env:GITHUB_STEP_SUMMARY "- ‚úÖ Passed: $passed"
          Add-Content $env:GITHUB_STEP_SUMMARY "- ‚ùå Failed: $failed"
          Add-Content $env:GITHUB_STEP_SUMMARY "- ‚ö†Ô∏è Skipped: $skipped"
          Add-Content $env:GITHUB_STEP_SUMMARY "- üß© Total: $total"

        shell: pwsh
